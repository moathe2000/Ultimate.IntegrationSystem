@page "/employees"
@inject EmployeeService EmployeeService
@inject IStringLocalizer<Employees> L
@using Microsoft.Extensions.Localization
@using MudBlazor
@using Ultimate.IntegrationSystem.Web.Models
@using Ultimate.IntegrationSystem.Web.Service

<MudPaper Class="pa-4 mx-auto" Style="max-width:1200px">
    <MudStack Direction="Row"
              Justify="Justify.SpaceBetween"
              AlignItems="AlignItems.Center">
        <MudText Typo="Typo.h5">@L["EmployeesTitle"]</MudText>
        <MudStack Direction="Row" Spacing="1">
            <MudButton Color="Color.Primary"
                       Variant="Variant.Filled"
                       StartIcon="@Icons.Material.Filled.PersonAdd">
                @L["AddEmployee"]
            </MudButton>
            <MudButton Color="Color.Secondary"
                       Variant="Variant.Outlined"
                       StartIcon="@Icons.Material.Filled.MailOutline">
                @L["InviteEmployees"]
            </MudButton>
        </MudStack>
    </MudStack>

    <MudGrid Class="mt-4" Gutter="3">
        <MudItem xs="12" sm="6">
            <MudTextField @bind-Value="searchTerm"
                          Placeholder="@L["SearchHint"]"
                          Adornment="Adornment.Start"
                          AdornmentIcon="@Icons.Material.Filled.Search"
                          FullWidth="true" />
        </MudItem>
        <MudItem xs="12" sm="6">
            <MudStack Direction="Row" AlignItems="AlignItems.Center" Spacing="1">
                <MudText>@L["StatusLabel"]</MudText>
                <MudSelect T="string"
                           @bind-Value="selectedStatus"
                           Dense="true"
                           Style="min-width:120px">
                    <MudSelectItem T="string" >"hggh"</MudSelectItem>
                    <MudSelectItem T="string" >"00585""</MudSelectItem>
                    <MudSelectItem T="string" >"Inactive"</MudSelectItem>
                </MudSelect>
            </MudStack>
        </MudItem>
    </MudGrid>

    <MudTable Items="filteredEmployees"
              Hover="true"
              Bordered="true"
              Striped="true"
              Class="mt-4">
        <HeaderContent>
            <MudTh DataLabel="@L["Number"]">@L["Number"]</MudTh>
            <MudTh DataLabel="@L["Name"]">@L["Name"]</MudTh>
            <MudTh DataLabel="@L["JobTitle"]">@L["JobTitle"]</MudTh>
            <MudTh DataLabel="@L["Department"]">@L["Department"]</MudTh>
            <MudTh DataLabel="@L["Branch"]">@L["Branch"]</MudTh>
            <MudTh DataLabel="@L["JoinDate"]">@L["JoinDate"]</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="@L["Number"]">@context.EmployeeNumber</MudTd>
            <MudTd DataLabel="@L["Name"]">
                <!-- عرض Avatar افتراضية بدلاً من PhotoUrl -->
                <MudAvatar Icon="@Icons.Material.Filled.Person"
                           Size="Size.Medium"
                           Class="mr-2" />
                @context.Name
            </MudTd>
            <MudTd DataLabel="@L["JobTitle"]">@context.JobTitle</MudTd>
            <MudTd DataLabel="@L["Department"]">@context.Department</MudTd>
            <MudTd DataLabel="@L["Branch"]">@context.Branch</MudTd>
            <MudTd DataLabel="@L["JoinDate"]">
                @context.JoinDate.ToString("yyyy-MM-dd")
            </MudTd>
        </RowTemplate>
        <PagerContent>
            <MudTablePager PageSizeOptions="new int[] { 5, 10, 20 }" />
        </PagerContent>
    </MudTable>
</MudPaper>

@code {
    private string searchTerm = "";
    private string selectedStatus = "All";

    private List<Employee> allEmployees;
    private IEnumerable<Employee> filteredEmployees =>
      allEmployees.Where(e =>
        (string.IsNullOrWhiteSpace(searchTerm) ||
         e.Name.Contains(searchTerm, StringComparison.OrdinalIgnoreCase)) &&
        (selectedStatus == "All" || e.Status == selectedStatus)
      );

    protected override void OnInitialized()
    {
        allEmployees = EmployeeService.GetAllEmployees();
    }
}
