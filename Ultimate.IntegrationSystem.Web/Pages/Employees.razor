@page "/employees"
@inject EmployeeService EmployeeService
@inject IStringLocalizer<Employees> L
@using Microsoft.Extensions.Localization
@using Ultimate.IntegrationSystem.Web.Models
@using MudBlazor
@using Ultimate.IntegrationSystem.Web.Service

<MudPaper Class="pa-4">
    <MudGrid>
        <MudItem xs="6">
            <MudText Typo="Typo.h5">@L["EmployeesTitle"]</MudText>
        </MudItem>
        <MudItem xs="6" Class="d-flex justify-end">
            <MudButton Variant="Variant.Filled">@L["AddEmployee"]</MudButton>
            <MudButton Variant="Variant.Outlined" Class="ml-2">@L["InviteEmployees"]</MudButton>
        </MudItem>
    </MudGrid>

    <MudGrid Class="my-3">
        <MudItem xs="12" sm="6">
            <MudSelect T="string" @bind-Value="SelectedStatus" Label="@L["StatusLabel"]">
                <MudSelectItem Value="@L["All"]"></MudSelectItem>
                <MudSelectItem Value="@L["Active"]"></MudSelectItem>
                <MudSelectItem Value="@L["Inactive"]"></MudSelectItem>

            </MudSelect>
        </MudItem>
        <MudItem xs="12" sm="6">
            <MudTextField @bind-Value="SearchTerm" Label="@L["SearchHint"]"
                          Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" />
        </MudItem>
    </MudGrid>

    <MudTable Items="FilteredEmployees" Hover="true" Bordered="true" Striped="true">
        <HeaderContent>
            <MudTh>@L["Number"]</MudTh>
            <MudTh>@L["Name"]</MudTh>
            <MudTh>@L["JobTitle"]</MudTh>
            <MudTh>@L["Department"]</MudTh>
            <MudTh>@L["Branch"]</MudTh>
            <MudTh>@L["JoinDate"]</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd>@context.EmployeeNumber</MudTd>
            <MudTd>@context.Name</MudTd>
            <MudTd>@context.JobTitle</MudTd>
            <MudTd>@context.Department</MudTd>
            <MudTd>@context.Branch</MudTd>
            <MudTd>@context.JoinDate.ToString("yyyy-MM-dd")</MudTd>
        </RowTemplate>
    </MudTable>
</MudPaper>

@code {
    private string SearchTerm = "";
    private string SelectedStatus = "All";

    private List<Employee> AllEmployees;
    private List<Employee> FilteredEmployees => AllEmployees
        .Where(e =>
            (string.IsNullOrWhiteSpace(SearchTerm) || e.Name.Contains(SearchTerm, StringComparison.OrdinalIgnoreCase)) &&
            (SelectedStatus == "All" || e.Status == SelectedStatus)
        ).ToList();

    protected override void OnInitialized()
    {
        AllEmployees = EmployeeService.GetAllEmployees();
    }
}
